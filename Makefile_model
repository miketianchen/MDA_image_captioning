# Driver script
#
#
# usage: make train

train: ../s3/results/final_model.hdf5

caption: ../s3/results/test.json

../s3/results/train_paths.pkl ../s3/results/train_descriptions.pkl ../s3/results/model_info.json: scr/models/prepare_data.py ../s3/json/train.json ../s3/json/valid.json

	python scr/models/prepare_data.py ../s3 train valid

../s3/results/train.pkl: scr/models/extract_features.py scr/models/model.py scr/models/hms_string.py ../s3/results/model_info.json ../s3/results/train_paths.pkl

	python scr/models/extract_features.py ../s3 train

../s3/results/final_model.hdf5: scr/models/train.py scr/models/model.py scr/models/hms_string.py ../s3/results/model_info.json ../s3/results/train_descriptions.pkl ../s3/results/train.pkl 

	python scr/models/train.py ../s3 final_model

../s3/results/test.pkl ../s3/results/test_paths.pkl: scr/models/extract_features.py scr/models/model.py scr/models/hms_string.py ../s3/results/model_info.json

	python scr/models/extract_features.py ../s3 test --inputs=test

../s3/results/test.json: scr/models/generate_captions.py scr/models/hms_string.py ../s3/results/test.pkl ../s3/results/test_paths.pkl ../s3/results/final_model.hdf5

	python scr/models/generate_captions.py ../s3 test final_model test

clean:
	rm -rf ../s3/results/*.json
	rm -rf ../s3/results/*.pkl
	rm -rf ../s3/results/*.hdh5
